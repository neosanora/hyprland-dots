#!/usr/bin/env bash
# ----------------------------------------
# Auto NVIDIA Env Config for Hyprland
# ----------------------------------------

# Deteksi GPU NVIDIA
if lspci | grep -qi "NVIDIA"; then
    echo "[Hyprland] NVIDIA GPU terdeteksi. Mengaktifkan env NVIDIA..."

    export XDG_CURRENT_DESKTOP="Hyprland"
    export XDG_SESSION_TYPE="wayland"
    export XDG_SESSION_DESKTOP="Hyprland"

    # Core NVIDIA
    export GBM_BACKEND="nvidia-drm"
    export LIBVA_DRIVER_NAME="nvidia"
    export SDL_VIDEODRIVER="wayland"
    export __GLX_VENDOR_LIBRARY_NAME="nvidia"
    export __NV_PRIME_RENDER_OFFLOAD=1
    export __VK_LAYER_NV_optimus="NVIDIA_only"
    export WLR_NO_HARDWARE_CURSORS=1
    export WLR_RENDERER_ALLOW_SOFTWARE=1

    # VRR / G-Sync
    export __GL_VRR_ALLOWED=1
    export __GL_GSYNC_ALLOWED=1

    # Firefox
    export MOZ_ENABLE_WAYLAND=1
    export MOZ_DISABLE_RDD_SANDBOX=1
    export EGL_PLATFORM="wayland"

    # Qt
    export QT_QPA_PLATFORM="wayland;xcb"
    export QT_AUTO_SCREEN_SCALE_FACTOR=1
    export QT_WAYLAND_DISABLE_WINDOWDECORATION=1

    # GTK
    export GDK_BACKEND="wayland,x11,*"
    export GDK_SCALE=1

    # Electron / Chromium
    export OZONE_PLATFORM="wayland"
    export ELECTRON_OZONE_PLATFORM_HINT="wayland"
else
    echo "[Hyprland] NVIDIA GPU tidak terdeteksi. Melewati env NVIDIA..."
fi

